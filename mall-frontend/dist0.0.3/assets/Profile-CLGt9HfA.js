import{d as x,u as A,r as g,D,o as E,a as m,b as e,f as a,i as r,t as _,m as $,g as n,h as u,p as I,M as L,N as j,O as J,A as R,P as z,j as h,G as f,s as v,_ as H}from"./index-Cs2oV9HB.js";const O={class:"profile-page"},T={class:"site-header"},K={class:"container header-content"},Q={class:"user-area"},W={class:"container"},X={class:"profile-layout"},Y={class:"side-menu"},Z={class:"avatar-box"},F=["src"],ss={class:"menu-list"},es={class:"main-content"},ts={class:"user-card"},as={class:"avatar-wrap"},os=["src"],ls={class:"info"},ns={class:"welcome"},rs={class:"portal-box"},is={class:"box-hd"},us={class:"box-bd"},ds={key:0,class:"badge"},ps={key:0,class:"badge"},cs=["src"],fs={class:"dialog-footer"},C="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",vs=x({__name:"Profile",setup(ms){const o=A(),d=g({unpaid:0,unshipped:0}),V="http://8.163.12.69:8081/file/upload",c=g(!1),k=g(!1),i=D({nickname:"",avatar:""}),P=()=>{i.nickname=o.userInfo.nickname||o.userInfo.username,i.avatar=o.userInfo.avatar||"",c.value=!0},w=t=>{t.code==="200"?(i.avatar=t.data,f.success("图片上传成功")):f.error(t.msg||"上传失败")},N=t=>{const s=t.type==="image/jpeg"||t.type==="image/png",p=t.size/1024/1024<2;return s?p?!0:(f.error("头像大小不能超过 2MB!"),!1):(f.error("头像必须是 JPG 或 PNG 格式!"),!1)},S=async()=>{k.value=!0;try{const t=await I.post("/user/update",{userId:o.userInfo.userId,nickname:i.nickname,avatar:i.avatar});o.userInfo=t,f.success("修改成功"),c.value=!1}catch(t){console.error(t)}finally{k.value=!1}},U=async()=>{if(o.userInfo.userId)try{const t=await I.get(`/order/list?userId=${o.userInfo.userId}`);d.value.unpaid=t.filter(s=>s.orderStatus===0).length,d.value.unshipped=t.filter(s=>s.orderStatus===1).length}catch{}};return E(()=>{U()}),(t,s)=>{const p=u("el-icon"),B=u("el-upload"),b=u("el-form-item"),M=u("el-input"),G=u("el-form"),y=u("el-button"),q=u("el-dialog");return v(),m("div",O,[e("div",T,[e("div",K,[e("h2",{class:"logo",onClick:s[0]||(s[0]=l=>t.$router.push("/"))},"大米商城"),s[12]||(s[12]=e("div",{class:"header-title"},"个人中心",-1)),e("div",Q,[e("span",{class:"link",onClick:s[1]||(s[1]=l=>t.$router.push("/"))},"返回首页")])])]),e("div",W,[e("div",X,[e("div",Y,[e("div",Z,[e("img",{src:r(o).userInfo.avatar||C,alt:"avatar"},null,8,F),e("h3",null,_(r(o).userInfo.nickname||r(o).userInfo.username),1)]),e("ul",ss,[s[13]||(s[13]=e("li",{class:"active"},"我的个人中心",-1)),e("li",{onClick:s[2]||(s[2]=l=>t.$router.push("/order/list"))},"我的订单"),e("li",{onClick:s[3]||(s[3]=l=>t.$router.push("/user/address"))},"收货地址"),e("li",{onClick:s[4]||(s[4]=l=>t.$router.push("/user/security"))},"账户安全")])]),e("div",es,[e("div",ts,[e("div",as,[e("img",{src:r(o).userInfo.avatar||C,alt:"avatar"},null,8,os)]),e("div",ls,[e("div",ns,"Hello, "+_(r(o).userInfo.nickname||r(o).userInfo.username),1),s[14]||(s[14]=e("div",{class:"tips"},"今天也是充满活力的一天！",-1)),e("div",{class:"link",onClick:P},"修改个人资料 >")])]),e("div",rs,[e("div",is,[s[15]||(s[15]=e("h3",null,"我的订单",-1)),e("span",{class:"more",onClick:s[5]||(s[5]=l=>t.$router.push("/order/list"))},"查看全部订单 >")]),e("div",us,[e("div",{class:"status-item",onClick:s[6]||(s[6]=l=>t.$router.push({path:"/order/list",query:{status:"0"}}))},[a(p,{class:"icon",style:{background:"#ff9f43"}},{default:n(()=>[a(r(L))]),_:1}),s[16]||(s[16]=e("span",null,"待付款",-1)),d.value.unpaid>0?(v(),m("span",ds,_(d.value.unpaid),1)):$("",!0)]),e("div",{class:"status-item",onClick:s[7]||(s[7]=l=>t.$router.push({path:"/order/list",query:{status:"1"}}))},[a(p,{class:"icon",style:{background:"#ff6b6b"}},{default:n(()=>[a(r(j))]),_:1}),s[17]||(s[17]=e("span",null,"待发货",-1)),d.value.unshipped>0?(v(),m("span",ps,_(d.value.unshipped),1)):$("",!0)]),e("div",{class:"status-item",onClick:s[8]||(s[8]=l=>t.$router.push({path:"/order/list",query:{status:"2"}}))},[a(p,{class:"icon",style:{background:"#1dd1a1"}},{default:n(()=>[a(r(J))]),_:1}),s[18]||(s[18]=e("span",null,"已发货",-1))])])])])])]),a(q,{modelValue:c.value,"onUpdate:modelValue":s[11]||(s[11]=l=>c.value=l),title:"修改个人资料",width:"500px"},{footer:n(()=>[e("span",fs,[a(y,{onClick:s[10]||(s[10]=l=>c.value=!1)},{default:n(()=>[...s[20]||(s[20]=[h("取消",-1)])]),_:1}),a(y,{type:"primary",onClick:S,loading:k.value},{default:n(()=>[...s[21]||(s[21]=[h("保存",-1)])]),_:1},8,["loading"])])]),default:n(()=>[a(G,{"label-width":"80px",class:"edit-form"},{default:n(()=>[a(b,{label:"头像"},{default:n(()=>[a(B,{class:"avatar-uploader",action:V,"show-file-list":!1,"on-success":w,"before-upload":N},{default:n(()=>[i.avatar?(v(),m("img",{key:0,src:i.avatar,class:"avatar"},null,8,cs)):(v(),R(p,{key:1,class:"avatar-uploader-icon"},{default:n(()=>[a(r(z))]),_:1}))]),_:1}),s[19]||(s[19]=e("div",{class:"tips-text"},"支持 JPG/PNG，大小不超过 2MB",-1))]),_:1}),a(b,{label:"昵称"},{default:n(()=>[a(M,{modelValue:i.nickname,"onUpdate:modelValue":s[9]||(s[9]=l=>i.nickname=l),placeholder:"请输入新昵称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),gs=H(vs,[["__scopeId","data-v-f4566950"]]);export{gs as default};
