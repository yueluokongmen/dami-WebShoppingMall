import{d as E,u as R,r as I,D as q,c as x,o as M,a as i,b as s,f as d,F as N,l as A,t as a,g as r,h as f,p as k,G as b,q as j,n as z,j as p,s as u,_ as G}from"./index-Cs2oV9HB.js";const T={class:"checkout-page"},H={class:"site-header"},J={class:"container header-content"},K={class:"container"},O={class:"checkout-box"},W={class:"section-address"},X={class:"address-list"},Y=["onClick"],Z={class:"name"},ee={class:"tel"},se={class:"addr"},te={key:0,class:"action"},le={key:1,class:"action"},oe={class:"section-goods"},de={class:"goods-list"},ae={class:"img-box"},re=["src"],ne={class:"name"},ie={class:"pro-name"},ue={class:"price"},ce={class:"total"},ve={class:"section-count"},pe={class:"money-box"},me={class:"row"},_e={class:"val"},fe={class:"row"},be={class:"val"},ye={class:"row total-row"},ge={class:"total-price"},Ve={class:"btn-box"},Ie={class:"dialog-footer"},$="/imgs/default.webp",ke=E({__name:"Checkout",setup(he){const y=R(),h=j(),m=I([]),g=I([]),n=I(null),_=I(!1),l=q({receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailedAddress:""}),U=o=>{n.value=o},P=async()=>{if(!l.receiverName||!l.receiverPhone||!l.detailedAddress){b.warning("请填写完整的地址信息");return}try{await k.post("/address/add",{userId:y.userInfo.userId,...l}),b.success("添加成功"),_.value=!1,l.receiverName="",l.receiverPhone="",l.province="",l.city="",l.district="",l.detailedAddress="",w()}catch(o){console.error(o)}},w=async()=>{try{const o=await k.get(`/address/list?userId=${y.userInfo.userId}`);g.value=o,!n.value&&g.value.length>0&&(n.value=g.value[0])}catch(o){console.error(o)}},F=o=>{o.target.src=$},D=async()=>{const o=await k.get(`/cart/list?userId=${y.userInfo.userId}`);if(m.value=o.filter(e=>e.selected===1),m.value.length===0){b.warning("没有待结算的商品"),h.push("/cart");return}w()},C=x(()=>m.value.reduce((o,e)=>o+e.price*e.cartQuantity,0).toFixed(2)),L=x(()=>m.value.reduce((o,e)=>o+e.cartQuantity,0)),Q=async()=>{if(!n.value)return b.error("请选择地址");const o={userId:y.userInfo.userId,addressId:n.value.addressId};try{const e=await k.post("/order/submit",o);b.success("下单成功！"),h.push(`/pay?orderNo=${e}`)}catch(e){console.error(e)}};return M(()=>{D()}),(o,e)=>{const V=f("el-button"),c=f("el-input"),v=f("el-form-item"),S=f("el-form"),B=f("el-dialog");return u(),i("div",T,[s("div",H,[s("div",J,[s("h2",{class:"logo",onClick:e[0]||(e[0]=t=>o.$router.push("/"))},"大米商城"),e[11]||(e[11]=s("div",{class:"divider"},"|",-1)),e[12]||(e[12]=s("div",{class:"header-title"},"确认订单",-1))])]),s("div",K,[s("div",O,[s("div",W,[e[15]||(e[15]=s("h3",null,"收货地址",-1)),s("div",X,[(u(!0),i(N,null,A(g.value,t=>(u(),i("div",{class:z(["address-item",{active:n.value&&n.value.addressId===t.addressId}]),key:t.addressId,onClick:we=>U(t)},[s("div",Z,a(t.receiverName),1),s("div",ee,a(t.receiverPhone),1),s("div",se,[p(a(t.province)+" "+a(t.city)+" "+a(t.district),1),e[13]||(e[13]=s("br",null,null,-1)),p(" "+a(t.detailedAddress),1)]),n.value&&n.value.addressId===t.addressId?(u(),i("span",te,"已选")):(u(),i("span",le,"选择"))],10,Y))),128)),s("div",{class:"address-item add-new",onClick:e[1]||(e[1]=t=>_.value=!0)},[...e[14]||(e[14]=[s("div",{class:"icon"},"+",-1),s("div",null,"添加新地址",-1)])])])]),s("div",oe,[e[16]||(e[16]=s("h3",null,"商品清单",-1)),s("div",de,[(u(!0),i(N,null,A(m.value,t=>(u(),i("div",{class:"item",key:t.skuId},[s("div",ae,[s("img",{src:t.productImage||$,onError:F,alt:""},null,40,re)]),s("div",ne,[s("span",ie,a(t.productName),1)]),s("div",ue,a(t.price)+"元 x "+a(t.cartQuantity),1),s("div",ce,a((t.price*t.cartQuantity).toFixed(2))+"元",1)]))),128))])]),s("div",ve,[s("div",pe,[s("div",me,[e[17]||(e[17]=s("label",null,"商品件数：",-1)),s("span",_e,a(L.value)+"件",1)]),s("div",fe,[e[18]||(e[18]=s("label",null,"商品总价：",-1)),s("span",be,a(C.value)+"元",1)]),e[21]||(e[21]=s("div",{class:"row"},[s("label",null,"运费："),s("span",{class:"val"},"0元")],-1)),s("div",ye,[e[19]||(e[19]=s("label",null,"应付总额：",-1)),s("span",ge,a(C.value),1),e[20]||(e[20]=s("span",{class:"unit"},"元",-1))])]),s("div",Ve,[d(V,{class:"btn-back",onClick:e[2]||(e[2]=t=>o.$router.push("/cart"))},{default:r(()=>[...e[22]||(e[22]=[p("返回购物车",-1)])]),_:1}),d(V,{type:"primary",class:"btn-submit",onClick:Q},{default:r(()=>[...e[23]||(e[23]=[p("立即下单",-1)])]),_:1})])])])]),d(B,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=t=>_.value=t),title:"添加收货地址",width:"500px"},{footer:r(()=>[s("span",Ie,[d(V,{onClick:e[9]||(e[9]=t=>_.value=!1)},{default:r(()=>[...e[24]||(e[24]=[p("取消",-1)])]),_:1}),d(V,{type:"primary",onClick:P},{default:r(()=>[...e[25]||(e[25]=[p("保存",-1)])]),_:1})])]),default:r(()=>[d(S,{model:l,"label-width":"100px"},{default:r(()=>[d(v,{label:"姓名"},{default:r(()=>[d(c,{modelValue:l.receiverName,"onUpdate:modelValue":e[3]||(e[3]=t=>l.receiverName=t),placeholder:"收货人姓名"},null,8,["modelValue"])]),_:1}),d(v,{label:"电话"},{default:r(()=>[d(c,{modelValue:l.receiverPhone,"onUpdate:modelValue":e[4]||(e[4]=t=>l.receiverPhone=t),placeholder:"11位手机号"},null,8,["modelValue"])]),_:1}),d(v,{label:"省份"},{default:r(()=>[d(c,{modelValue:l.province,"onUpdate:modelValue":e[5]||(e[5]=t=>l.province=t),placeholder:"如：广东省"},null,8,["modelValue"])]),_:1}),d(v,{label:"城市"},{default:r(()=>[d(c,{modelValue:l.city,"onUpdate:modelValue":e[6]||(e[6]=t=>l.city=t),placeholder:"如：深圳市"},null,8,["modelValue"])]),_:1}),d(v,{label:"区/县"},{default:r(()=>[d(c,{modelValue:l.district,"onUpdate:modelValue":e[7]||(e[7]=t=>l.district=t),placeholder:"如：南山区"},null,8,["modelValue"])]),_:1}),d(v,{label:"详细地址"},{default:r(()=>[d(c,{type:"textarea",modelValue:l.detailedAddress,"onUpdate:modelValue":e[8]||(e[8]=t=>l.detailedAddress=t),placeholder:"街道、楼牌号等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),xe=G(ke,[["__scopeId","data-v-e143f7cc"]]);export{xe as default};
