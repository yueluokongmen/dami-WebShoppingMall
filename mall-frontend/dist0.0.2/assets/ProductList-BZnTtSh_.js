import{d as F,r as h,c as J,o as Q,p as f,A as I,g as s,h as u,f as a,m as W,j as r,t as N,b as _,i as S,P as C,a as X,G as k,q as Y,K as U,s as y,_ as Z}from"./index-Cvb7EvRk.js";const ee={class:"card-header"},te={style:{"margin-bottom":"15px"}},le={style:{"font-size":"12px",color:"#999","margin-left":"10px"}},ae={style:{color:"#333"}},se=["src"],oe={class:"dialog-footer"},ne=F({__name:"ProductList",setup(de){const P=Y(),x=h([]),g=h(!1),c=h({}),w=h([]),z="http://8.163.12.69:8081/file/upload",E=J(()=>({token:localStorage.getItem("token")||""}));Q(()=>{b()});const b=async()=>{const l=await f.get("/admin/product/list");x.value=l},D=async(l,e)=>{try{await f.post(`/admin/product/status/${l}/${e}`),k.success(e===1?"已上架":"已下架")}catch{b()}},B=l=>{P.push({path:"/admin/product/add",query:{id:l}})},L=l=>{U.confirm("确定删除吗？","提示",{type:"warning"}).then(async()=>{await f.delete(`/admin/product/delete/${l}`),k.success("删除成功"),b()})},M=async l=>{c.value=l,g.value=!0,await V(l.productId)},V=async l=>{const e=await f.get(`/admin/sku/list?productId=${l}`);w.value=e},O=()=>{w.value.push({productId:c.value.productId,skuName:"",skuImage:c.value.images&&c.value.images[0]?c.value.images[0]:"",skuPrice:c.value.spuPrice,stock:999,specs:{}})},j=(l,e)=>{l.code===200?e.skuImage=l.data:k.error(l.msg)},q=async l=>{if(!l.skuName)return k.warning("请输入规格名称");const e={},m=l.skuName.split(" ");let o=!1;m.forEach(n=>{const[p,i]=n.split(/[:：]/);p&&i&&(e[p]=i,o=!0)}),o||(e.规格=l.skuName),l.specs=e,await f.post("/admin/sku/save",l),k.success("保存成功"),await K(l.productId),V(c.value.productId)},K=async l=>{const m=await f.get(`/admin/sku/list?productId=${l}`),o=new Map;m.forEach(p=>{p.specs&&Object.entries(p.specs).forEach(([i,v])=>{o.has(i)||o.set(i,new Set),o.get(i)?.add(String(v))})});const n=[];o.forEach((p,i)=>{n.push({label:i,value:Array.from(p)})}),await f.post("/admin/product/save",{productId:l,specOptions:n})},A=async l=>{if(!l.skuId){const e=w.value.indexOf(l);w.value.splice(e,1);return}U.confirm("确定删除该规格吗？","提示",{type:"warning"}).then(async()=>{await f.delete(`/admin/sku/delete/${l.skuId}`),k.success("删除成功"),V(c.value.productId)})};return(l,e)=>{const m=u("el-icon"),o=u("el-button"),n=u("el-table-column"),p=u("el-image"),i=u("el-switch"),v=u("el-table"),G=u("el-upload"),R=u("el-input"),$=u("el-input-number"),H=u("el-dialog"),T=u("el-card");return y(),I(T,null,{header:s(()=>[_("div",ee,[e[4]||(e[4]=_("span",{style:{"font-weight":"bold"}},"商品管理列表",-1)),a(o,{type:"primary",onClick:e[0]||(e[0]=t=>l.$router.push("/admin/product/add"))},{default:s(()=>[a(m,null,{default:s(()=>[a(S(C))]),_:1}),e[3]||(e[3]=r(" 发布新商品 ",-1))]),_:1})])]),default:s(()=>[a(v,{data:x.value,style:{width:"100%"},border:"",stripe:""},{default:s(()=>[a(n,{prop:"productId",label:"ID",width:"60",align:"center"}),a(n,{label:"主图",width:"80",align:"center"},{default:s(t=>[t.row.images&&t.row.images.length>0?(y(),I(p,{key:0,style:{width:"40px",height:"40px","border-radius":"4px"},src:t.row.images[0],"preview-teleported":""},null,8,["src"])):W("",!0)]),_:1}),a(n,{prop:"productName",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),a(n,{prop:"spuPrice",label:"起售价",width:"100",align:"center"},{default:s(t=>[r("￥"+N(t.row.spuPrice),1)]),_:1}),a(n,{label:"上架状态",width:"100",align:"center"},{default:s(t=>[a(i,{modelValue:t.row.productStatus,"onUpdate:modelValue":d=>t.row.productStatus=d,"active-value":1,"inactive-value":0,onChange:d=>D(t.row.productId,d)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(n,{label:"操作",width:"220",align:"center",fixed:"right"},{default:s(t=>[a(o,{type:"warning",size:"small",plain:"",onClick:d=>M(t.row)},{default:s(()=>[...e[5]||(e[5]=[r(" SKU配置 ",-1)])]),_:1},8,["onClick"]),a(o,{type:"primary",size:"small",link:"",onClick:d=>B(t.row.productId)},{default:s(()=>[...e[6]||(e[6]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(o,{type:"danger",size:"small",link:"",onClick:d=>L(t.row.productId)},{default:s(()=>[...e[7]||(e[7]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),a(H,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=t=>g.value=t),title:"SKU 规格管理",width:"800px"},{footer:s(()=>[_("div",oe,[a(o,{onClick:e[1]||(e[1]=t=>g.value=!1)},{default:s(()=>[...e[12]||(e[12]=[r("关闭",-1)])]),_:1})])]),default:s(()=>[_("div",te,[a(o,{type:"primary",onClick:O},{default:s(()=>[a(m,null,{default:s(()=>[a(S(C))]),_:1}),e[8]||(e[8]=r(" 添加新规格 ",-1))]),_:1}),_("span",le,[e[9]||(e[9]=r(" 当前正在管理: ",-1)),_("b",ae,N(c.value.productName),1)])]),a(v,{data:w.value,border:"",style:{width:"100%"}},{default:s(()=>[a(n,{label:"规格图",width:"80",align:"center"},{default:s(t=>[a(G,{class:"sku-uploader",action:z,headers:E.value,"show-file-list":!1,"on-success":d=>j(d,t.row)},{default:s(()=>[t.row.skuImage?(y(),X("img",{key:0,src:t.row.skuImage,class:"sku-img"},null,8,se)):(y(),I(m,{key:1,class:"sku-uploader-icon"},{default:s(()=>[a(S(C))]),_:1}))]),_:2},1032,["headers","on-success"])]),_:1}),a(n,{label:"规格名称 (如: 红色 64G)","min-width":"180"},{default:s(t=>[a(R,{modelValue:t.row.skuName,"onUpdate:modelValue":d=>t.row.skuName=d,placeholder:"请输入规格名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(n,{label:"价格",width:"120"},{default:s(t=>[a($,{modelValue:t.row.skuPrice,"onUpdate:modelValue":d=>t.row.skuPrice=d,min:0,precision:2,size:"small",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(n,{label:"库存",width:"120"},{default:s(t=>[a($,{modelValue:t.row.stock,"onUpdate:modelValue":d=>t.row.stock=d,min:0,size:"small",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(n,{label:"操作",width:"140",align:"center"},{default:s(t=>[a(o,{type:"success",size:"small",link:"",onClick:d=>q(t.row)},{default:s(()=>[...e[10]||(e[10]=[r("保存",-1)])]),_:1},8,["onClick"]),a(o,{type:"danger",size:"small",link:"",onClick:d=>A(t.row)},{default:s(()=>[...e[11]||(e[11]=[r("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})}}}),ie=Z(ne,[["__scopeId","data-v-6959fc44"]]);export{ie as default};
