import{d as M,u as V,r as N,D as z,c as h,o as A,a as i,b as e,m as P,t as r,j as f,F as y,l as k,f as b,g as x,h as C,H as j,p as I,G as m,n as q,q as F,s as l,_ as R}from"./index-Cvb7EvRk.js";const T={class:"detail-page"},G={class:"site-header"},H={class:"container header-content"},Q={class:"header-info"},U={class:"product-name"},K={key:0,class:"container main-content"},W={class:"img-box"},X=["src"],Y={class:"info-box"},Z={class:"title"},ss={class:"desc"},es={class:"price-box"},ts={class:"price"},os={class:"option-title"},as={class:"option-list"},ns=["onClick"],rs={class:"total-box"},is={class:"item"},ls={class:"total-price"},cs={class:"btn-box"},us={key:1,class:"container loading-box"},ds={key:2,class:"container detail-content"},ps={class:"content"},vs=M({__name:"Detail",setup(_s){const S=j(),w=F(),d=V(),o=N({}),O=N([]),u=z({}),c=h(()=>O.value.find(t=>{const s=t.specs||{};return Object.keys(u).every(a=>s[a]===u[a])})),g=h(()=>c.value?c.value.skuPrice:o.value.spuPrice),D=h(()=>c.value&&c.value.skuImage?c.value.skuImage:o.value.images&&o.value.images.length>0?o.value.images[0]:""),$=async()=>{const t=S.params.id;if(t)try{const s=await I.get(`/spu/detail/${t}`),a=s.spu,v=s.skuList;typeof a.images=="string"&&(a.images=JSON.parse(a.images)),typeof a.specOptions=="string"&&(a.specOptions=JSON.parse(a.specOptions)),Array.isArray(a.specOptions)&&a.specOptions.forEach(n=>{if(typeof n.list=="string")try{n.list=JSON.parse(n.list)}catch{}}),v.forEach(n=>{if(typeof n.specs=="string")try{n.specs=JSON.parse(n.specs)}catch{}}),o.value=a,O.value=v,E(),d.userInfo.userId&&B(a)}catch(s){console.error(s),m.error("获取商品详情失败")}},E=()=>{o.value.specOptions&&o.value.specOptions.length>0&&o.value.specOptions.forEach(t=>{t.value&&t.value.length>0&&(u[t.label]=t.value[0])})},L=(t,s)=>{u[t]=s},B=async t=>{try{await I.post("/user/log/add",{userId:d.userInfo.userId,username:d.userInfo.username,productId:t.productId,productName:t.productName})}catch(s){console.error("Log error",s)}},J=async()=>{if(!d.userInfo.userId){m.warning("请先登录"),w.push("/login");return}if(!c.value){m.warning("该规格组合暂时缺货");return}const t={userId:d.userInfo.userId,skuId:c.value.skuId,cartQuantity:1};try{await I.post("/cart/add",t),m.success("成功加入购物车！")}catch(s){console.error(s)}};return A(()=>{$()}),(t,s)=>{const a=C("el-button"),v=C("el-skeleton");return l(),i("div",T,[e("div",G,[e("div",H,[e("h2",{class:"logo",onClick:s[0]||(s[0]=n=>t.$router.push("/"))},"大米商城"),e("div",Q,[e("span",U,r(o.value.productName||"商品详情"),1),s[2]||(s[2]=e("span",{class:"sep"},"|",-1)),e("span",{class:"link",onClick:s[1]||(s[1]=n=>t.$router.push("/"))},"返回首页")])])]),o.value.productId?(l(),i("div",K,[e("div",W,[e("img",{src:D.value,alt:""},null,8,X)]),e("div",Y,[e("h1",Z,r(o.value.productName),1),e("p",ss,[s[3]||(s[3]=e("span",{class:"highlight"},"「购机赠大米手环」",-1)),f(" "+r(o.value.subtitle),1)]),e("div",es,[e("span",ts,r(g.value)+" 元",1)]),s[5]||(s[5]=e("div",{class:"line"},null,-1)),(l(!0),i(y,null,k(o.value.specOptions,(n,p)=>(l(),i("div",{class:"option-box",key:p},[e("div",os,"选择"+r(n.label),1),e("div",as,[(l(!0),i(y,null,k(n.value,_=>(l(),i("div",{class:q(["option-item",{active:u[n.label]===_}]),key:_,onClick:fs=>L(n.label,_)},r(_),11,ns))),128))])]))),128)),e("div",rs,[e("div",is,[e("div",null,[f(r(o.value.productName)+" ",1),(l(!0),i(y,null,k(u,(n,p)=>(l(),i("span",{key:p,style:{"margin-left":"5px"}},r(n),1))),128))]),e("span",null,r(g.value)+" 元",1)]),e("div",ls," 总计："+r(g.value)+" 元 ",1)]),e("div",cs,[b(a,{color:"#ff6700",size:"large",class:"buy-btn",onClick:J,disabled:!c.value},{default:x(()=>[f(r(c.value?"加入购物车":"该组合缺货"),1)]),_:1},8,["disabled"]),b(a,{type:"info",size:"large",class:"like-btn"},{default:x(()=>[...s[4]||(s[4]=[f("喜欢",-1)])]),_:1})])])])):(l(),i("div",us,[b(v,{rows:10,animated:""})])),o.value.detail?(l(),i("div",ds,[s[6]||(s[6]=e("h3",{class:"section-title"},"商品详情",-1)),e("div",ps,r(o.value.detail),1)])):P("",!0),s[7]||(s[7]=e("div",{class:"site-footer"},[e("div",{class:"container"},"大米商城 © 2025 Mi Mall Demo")],-1))])}}}),gs=R(vs,[["__scopeId","data-v-ea5db646"]]);export{gs as default};
