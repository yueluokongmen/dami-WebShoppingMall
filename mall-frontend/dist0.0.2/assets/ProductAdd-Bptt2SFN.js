import{d as J,r as i,c as N,H as K,D as Q,o as W,p as m,A as I,g as s,h as u,f as a,a as q,l as P,F as U,b as g,i as X,P as Y,j as V,G as f,q as Z,s as p,_ as ee}from"./index-Cvb7EvRk.js";const te={class:"card-header"},le=J({__name:"ProductAdd",setup(ae){const C=Z(),y=K(),c=i(),_=i(!1),w=i([]),v=i([]),n=i([]),L="http://8.163.12.69:8081/file/upload",h=N(()=>({token:localStorage.getItem("token")||""})),R=N(()=>!!y.query.id),t=Q({productId:null,categoryId:"",productFamilyId:"",productName:"",subtitle:"",spuPrice:0,detail:"",images:[],productStatus:1}),$={categoryId:[{required:!0,message:"请选择分类",trigger:"change"}],productFamilyId:[{required:!0,message:"请选择系列",trigger:"change"}],productName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],spuPrice:[{required:!0,message:"请输入价格",trigger:"blur"}],images:[{required:!0,message:"请至少上传一张图片",trigger:"change"}]};W(async()=>{await S(),y.query.id&&B(Number(y.query.id))});const B=async o=>{const e=await m.get(`/admin/product/info/${o}`);Object.assign(t,e),t.categoryId&&await F(t.categoryId),t.images&&t.images.length>0&&(n.value=t.images.map(r=>({name:"img",url:r})))},S=async()=>{const o=await m.get("/admin/category/list");w.value=o},F=async o=>{const e=await m.get(`/admin/product-family/list?categoryId=${o}`);v.value=e},A=async o=>{t.productFamilyId="",v.value=[],o&&await F(o)},E=(o,e)=>{if(o.code===200)t.images.push(o.data),f.success("上传成功");else{f.error(o.msg||"上传失败");const r=n.value.indexOf(e);r!==-1&&n.value.splice(r,1)}},j=o=>{const e=o.response?o.response.data:o.url;t.images=t.images.filter(r=>r!==e)},D=async()=>{if(c.value){if(t.images.length===0)return f.warning("请至少上传一张图片");await c.value.validate(async o=>{if(o){_.value=!0;try{await m.post("/admin/product/save",t),f.success(R.value?"修改成功":"发布成功"),C.push("/admin/products")}catch(e){console.error(e)}finally{_.value=!1}}})}},G=()=>{c.value.resetFields(),n.value=[],t.images=[]};return(o,e)=>{const r=u("el-button"),k=u("el-option"),x=u("el-select"),d=u("el-form-item"),b=u("el-input"),H=u("el-input-number"),M=u("el-icon"),O=u("el-upload"),T=u("el-form"),z=u("el-card");return p(),I(z,null,{header:s(()=>[g("div",te,[e[9]||(e[9]=g("span",null,"发布新商品 (SPU)",-1)),a(r,{onClick:e[0]||(e[0]=l=>o.$router.back())},{default:s(()=>[...e[8]||(e[8]=[V("返回列表",-1)])]),_:1})])]),default:s(()=>[a(T,{model:t,ref_key:"formRef",ref:c,rules:$,"label-width":"120px",style:{"max-width":"800px"}},{default:s(()=>[a(d,{label:"所属分类",prop:"categoryId"},{default:s(()=>[a(x,{modelValue:t.categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>t.categoryId=l),placeholder:"请选择一级分类",onChange:A,style:{width:"100%"}},{default:s(()=>[(p(!0),q(U,null,P(w.value,l=>(p(),I(k,{key:l.categoryId,label:l.categoryName,value:l.categoryId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"所属系列",prop:"productFamilyId"},{default:s(()=>[a(x,{modelValue:t.productFamilyId,"onUpdate:modelValue":e[2]||(e[2]=l=>t.productFamilyId=l),placeholder:"请先选择分类，再选择系列",disabled:!t.categoryId,style:{width:"100%"}},{default:s(()=>[(p(!0),q(U,null,P(v.value,l=>(p(),I(k,{key:l.productFamilyId,label:l.productFamilyName,value:l.productFamilyId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(d,{label:"商品名称",prop:"productName"},{default:s(()=>[a(b,{modelValue:t.productName,"onUpdate:modelValue":e[3]||(e[3]=l=>t.productName=l),placeholder:"例如：大米14 Pro"},null,8,["modelValue"])]),_:1}),a(d,{label:"副标题",prop:"subtitle"},{default:s(()=>[a(b,{modelValue:t.subtitle,"onUpdate:modelValue":e[4]||(e[4]=l=>t.subtitle=l),placeholder:"例如：徕卡光学镜头 | 骁龙8Gen3"},null,8,["modelValue"])]),_:1}),a(d,{label:"起售价",prop:"spuPrice"},{default:s(()=>[a(H,{modelValue:t.spuPrice,"onUpdate:modelValue":e[5]||(e[5]=l=>t.spuPrice=l),precision:2,step:100,min:0,style:{width:"200px"}},null,8,["modelValue"]),e[10]||(e[10]=g("span",{class:"tip"},"元 (仅作为展示起售价)",-1))]),_:1}),a(d,{label:"商品轮播图",prop:"images"},{default:s(()=>[a(O,{"file-list":n.value,"onUpdate:fileList":e[6]||(e[6]=l=>n.value=l),action:L,headers:h.value,"list-type":"picture-card","on-success":E,"on-remove":j,limit:5},{default:s(()=>[a(M,null,{default:s(()=>[a(X(Y))]),_:1})]),_:1},8,["file-list","headers"]),e[11]||(e[11]=g("div",{class:"tip"},"建议尺寸 800x800，第一张将作为商品主图",-1))]),_:1}),a(d,{label:"商品详情",prop:"detail"},{default:s(()=>[a(b,{modelValue:t.detail,"onUpdate:modelValue":e[7]||(e[7]=l=>t.detail=l),type:"textarea",rows:"4",placeholder:"请输入纯文本描述"},null,8,["modelValue"])]),_:1}),a(d,null,{default:s(()=>[a(r,{type:"primary",onClick:D,loading:_.value},{default:s(()=>[...e[12]||(e[12]=[V("立即发布",-1)])]),_:1},8,["loading"]),a(r,{onClick:G},{default:s(()=>[...e[13]||(e[13]=[V("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),se=ee(le,[["__scopeId","data-v-0475d5cc"]]);export{se as default};
