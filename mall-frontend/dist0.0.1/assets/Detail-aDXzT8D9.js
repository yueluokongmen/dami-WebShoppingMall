import{d as M,u as z,r as I,B as A,c as h,o as L,a as r,b as s,t as i,j as _,F as m,l as k,f as y,g as x,h as S,D as P,p as C,E as f,n as V,q as j,s as c,_ as q}from"./index-DSi-hGWH.js";const F={class:"detail-page"},R={class:"site-header"},T={class:"container header-content"},Q={class:"header-info"},U={class:"product-name"},G={key:0,class:"container main-content"},H={class:"img-box"},K=["src"],W={class:"info-box"},X={class:"title"},Y={class:"desc"},Z={class:"price-box"},ss={class:"price"},es={class:"option-title"},ts={class:"option-list"},as=["onClick"],os={class:"total-box"},ns={class:"item"},is={class:"total-price"},ls={class:"btn-box"},rs={key:1,class:"container loading-box"},cs=M({__name:"Detail",setup(us){const N=P(),D=j(),b=z(),n=I({}),O=I([]),u=A({}),l=h(()=>O.value.find(t=>{const e=t.specs||{};return Object.keys(u).every(o=>e[o]===u[o])})),g=h(()=>l.value?l.value.skuPrice:n.value.spuPrice),w=h(()=>l.value&&l.value.skuImage?l.value.skuImage:n.value.images&&n.value.images.length>0?n.value.images[0]:""),E=async()=>{const t=N.params.id;if(t)try{const e=await C.get(`/spu/detail/${t}`),o=e.spu,p=e.skuList;typeof o.images=="string"&&(o.images=JSON.parse(o.images)),typeof o.specOptions=="string"&&(o.specOptions=JSON.parse(o.specOptions)),Array.isArray(o.specOptions)&&o.specOptions.forEach(a=>{if(typeof a.list=="string")try{a.list=JSON.parse(a.list)}catch{}}),p.forEach(a=>{if(typeof a.specs=="string")try{a.specs=JSON.parse(a.specs)}catch{}}),n.value=o,O.value=p,$()}catch(e){console.error(e),f.error("获取商品详情失败")}},$=()=>{n.value.specOptions&&n.value.specOptions.length>0&&n.value.specOptions.forEach(t=>{t.value&&t.value.length>0&&(u[t.label]=t.value[0])})},B=(t,e)=>{u[t]=e},J=async()=>{if(!b.userInfo.userId){f.warning("请先登录"),D.push("/login");return}if(!l.value){f.warning("该规格组合暂时缺货");return}const t={userId:b.userInfo.userId,skuId:l.value.skuId,cartQuantity:1};try{await C.post("/cart/add",t),f.success("成功加入购物车！")}catch(e){console.error(e)}};return L(()=>{E()}),(t,e)=>{const o=S("el-button"),p=S("el-skeleton");return c(),r("div",F,[s("div",R,[s("div",T,[s("h2",{class:"logo",onClick:e[0]||(e[0]=a=>t.$router.push("/"))},"大米商城"),s("div",Q,[s("span",U,i(n.value.productName||"商品详情"),1),e[2]||(e[2]=s("span",{class:"sep"},"|",-1)),s("span",{class:"link",onClick:e[1]||(e[1]=a=>t.$router.push("/"))},"返回首页")])])]),n.value.productId?(c(),r("div",G,[s("div",H,[s("img",{src:w.value,alt:""},null,8,K)]),s("div",W,[s("h1",X,i(n.value.productName),1),s("p",Y,[e[3]||(e[3]=s("span",{class:"highlight"},"「购机赠大米手环」",-1)),_(" "+i(n.value.subtitle),1)]),s("div",Z,[s("span",ss,i(g.value)+" 元",1)]),e[5]||(e[5]=s("div",{class:"line"},null,-1)),(c(!0),r(m,null,k(n.value.specOptions,(a,d)=>(c(),r("div",{class:"option-box",key:d},[s("div",es,"选择"+i(a.label),1),s("div",ts,[(c(!0),r(m,null,k(a.value,v=>(c(),r("div",{class:V(["option-item",{active:u[a.label]===v}]),key:v,onClick:ds=>B(a.label,v)},i(v),11,as))),128))])]))),128)),s("div",os,[s("div",ns,[s("div",null,[_(i(n.value.productName)+" ",1),(c(!0),r(m,null,k(u,(a,d)=>(c(),r("span",{key:d,style:{"margin-left":"5px"}},i(a),1))),128))]),s("span",null,i(g.value)+" 元",1)]),s("div",is," 总计："+i(g.value)+" 元 ",1)]),s("div",ls,[y(o,{color:"#ff6700",size:"large",class:"buy-btn",onClick:J,disabled:!l.value},{default:x(()=>[_(i(l.value?"加入购物车":"该组合缺货"),1)]),_:1},8,["disabled"]),y(o,{type:"info",size:"large",class:"like-btn"},{default:x(()=>[...e[4]||(e[4]=[_("喜欢",-1)])]),_:1})])])])):(c(),r("div",rs,[y(p,{rows:10,animated:""})])),e[6]||(e[6]=s("div",{class:"site-footer"},[s("div",{class:"container"},"大米商城 © 2025 Mi Mall Demo")],-1))])}}}),vs=q(cs,[["__scopeId","data-v-dcf908da"]]);export{vs as default};
