import{d as D,u as R,r as I,B as q,c as x,o as M,a as i,b as s,f as d,F as N,l as A,t as a,g as r,h as f,p as h,E as b,q as j,n as z,j as p,s as u,_ as T}from"./index-DSi-hGWH.js";const G={class:"checkout-page"},H={class:"site-header"},J={class:"container header-content"},K={class:"container"},O={class:"checkout-box"},W={class:"section-address"},X={class:"address-list"},Y=["onClick"],Z={class:"name"},ee={class:"tel"},se={class:"addr"},te={key:0,class:"action"},oe={key:1,class:"action"},le={class:"section-goods"},de={class:"goods-list"},ae={class:"img-box"},re=["src"],ne={class:"name"},ie={class:"pro-name"},ue={class:"price"},ce={class:"total"},ve={class:"section-count"},pe={class:"money-box"},me={class:"row"},_e={class:"val"},fe={class:"row"},be={class:"val"},ye={class:"row total-row"},ge={class:"total-price"},Ve={class:"btn-box"},Ie={class:"dialog-footer"},$="https://images.unsplash.com/photo-1598327105666-5b89351aff23?w=100&h=100&fit=crop",he=D({__name:"Checkout",setup(ke){const y=R(),k=j(),m=I([]),g=I([]),n=I(null),_=I(!1),o=q({receiverName:"",receiverPhone:"",province:"",city:"",district:"",detailedAddress:""}),U=l=>{n.value=l},P=async()=>{if(!o.receiverName||!o.receiverPhone||!o.detailedAddress){b.warning("请填写完整的地址信息");return}try{await h.post("/address/add",{userId:y.userInfo.userId,...o}),b.success("添加成功"),_.value=!1,o.receiverName="",o.receiverPhone="",o.province="",o.city="",o.district="",o.detailedAddress="",w()}catch(l){console.error(l)}},w=async()=>{try{const l=await h.get(`/address/list?userId=${y.userInfo.userId}`);g.value=l,!n.value&&g.value.length>0&&(n.value=g.value[0])}catch(l){console.error(l)}},F=l=>{l.target.src=$},B=async()=>{const l=await h.get(`/cart/list?userId=${y.userInfo.userId}`);if(m.value=l.filter(e=>e.selected===1),m.value.length===0){b.warning("没有待结算的商品"),k.push("/cart");return}w()},C=x(()=>m.value.reduce((l,e)=>l+e.price*e.cartQuantity,0).toFixed(2)),E=x(()=>m.value.reduce((l,e)=>l+e.cartQuantity,0)),L=async()=>{if(!n.value)return b.error("请选择地址");const l={userId:y.userInfo.userId,addressId:n.value.addressId};try{const e=await h.post("/order/submit",l);b.success("下单成功！"),k.push(`/pay?orderNo=${e}`)}catch(e){console.error(e)}};return M(()=>{B()}),(l,e)=>{const V=f("el-button"),c=f("el-input"),v=f("el-form-item"),Q=f("el-form"),S=f("el-dialog");return u(),i("div",G,[s("div",H,[s("div",J,[s("h2",{class:"logo",onClick:e[0]||(e[0]=t=>l.$router.push("/"))},"大米商城"),e[11]||(e[11]=s("div",{class:"divider"},"|",-1)),e[12]||(e[12]=s("div",{class:"header-title"},"确认订单",-1))])]),s("div",K,[s("div",O,[s("div",W,[e[15]||(e[15]=s("h3",null,"收货地址",-1)),s("div",X,[(u(!0),i(N,null,A(g.value,t=>(u(),i("div",{class:z(["address-item",{active:n.value&&n.value.addressId===t.addressId}]),key:t.addressId,onClick:we=>U(t)},[s("div",Z,a(t.receiverName),1),s("div",ee,a(t.receiverPhone),1),s("div",se,[p(a(t.province)+" "+a(t.city)+" "+a(t.district),1),e[13]||(e[13]=s("br",null,null,-1)),p(" "+a(t.detailedAddress),1)]),n.value&&n.value.addressId===t.addressId?(u(),i("span",te,"已选")):(u(),i("span",oe,"选择"))],10,Y))),128)),s("div",{class:"address-item add-new",onClick:e[1]||(e[1]=t=>_.value=!0)},[...e[14]||(e[14]=[s("div",{class:"icon"},"+",-1),s("div",null,"添加新地址",-1)])])])]),s("div",le,[e[16]||(e[16]=s("h3",null,"商品清单",-1)),s("div",de,[(u(!0),i(N,null,A(m.value,t=>(u(),i("div",{class:"item",key:t.skuId},[s("div",ae,[s("img",{src:t.productImage||$,onError:F,alt:""},null,40,re)]),s("div",ne,[s("span",ie,a(t.productName),1)]),s("div",ue,a(t.price)+"元 x "+a(t.cartQuantity),1),s("div",ce,a((t.price*t.cartQuantity).toFixed(2))+"元",1)]))),128))])]),s("div",ve,[s("div",pe,[s("div",me,[e[17]||(e[17]=s("label",null,"商品件数：",-1)),s("span",_e,a(E.value)+"件",1)]),s("div",fe,[e[18]||(e[18]=s("label",null,"商品总价：",-1)),s("span",be,a(C.value)+"元",1)]),e[21]||(e[21]=s("div",{class:"row"},[s("label",null,"运费："),s("span",{class:"val"},"0元")],-1)),s("div",ye,[e[19]||(e[19]=s("label",null,"应付总额：",-1)),s("span",ge,a(C.value),1),e[20]||(e[20]=s("span",{class:"unit"},"元",-1))])]),s("div",Ve,[d(V,{class:"btn-back",onClick:e[2]||(e[2]=t=>l.$router.push("/cart"))},{default:r(()=>[...e[22]||(e[22]=[p("返回购物车",-1)])]),_:1}),d(V,{type:"primary",class:"btn-submit",onClick:L},{default:r(()=>[...e[23]||(e[23]=[p("立即下单",-1)])]),_:1})])])])]),d(S,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=t=>_.value=t),title:"添加收货地址",width:"500px"},{footer:r(()=>[s("span",Ie,[d(V,{onClick:e[9]||(e[9]=t=>_.value=!1)},{default:r(()=>[...e[24]||(e[24]=[p("取消",-1)])]),_:1}),d(V,{type:"primary",onClick:P},{default:r(()=>[...e[25]||(e[25]=[p("保存",-1)])]),_:1})])]),default:r(()=>[d(Q,{model:o,"label-width":"100px"},{default:r(()=>[d(v,{label:"姓名"},{default:r(()=>[d(c,{modelValue:o.receiverName,"onUpdate:modelValue":e[3]||(e[3]=t=>o.receiverName=t),placeholder:"收货人姓名"},null,8,["modelValue"])]),_:1}),d(v,{label:"电话"},{default:r(()=>[d(c,{modelValue:o.receiverPhone,"onUpdate:modelValue":e[4]||(e[4]=t=>o.receiverPhone=t),placeholder:"11位手机号"},null,8,["modelValue"])]),_:1}),d(v,{label:"省份"},{default:r(()=>[d(c,{modelValue:o.province,"onUpdate:modelValue":e[5]||(e[5]=t=>o.province=t),placeholder:"如：广东省"},null,8,["modelValue"])]),_:1}),d(v,{label:"城市"},{default:r(()=>[d(c,{modelValue:o.city,"onUpdate:modelValue":e[6]||(e[6]=t=>o.city=t),placeholder:"如：深圳市"},null,8,["modelValue"])]),_:1}),d(v,{label:"区/县"},{default:r(()=>[d(c,{modelValue:o.district,"onUpdate:modelValue":e[7]||(e[7]=t=>o.district=t),placeholder:"如：南山区"},null,8,["modelValue"])]),_:1}),d(v,{label:"详细地址"},{default:r(()=>[d(c,{type:"textarea",modelValue:o.detailedAddress,"onUpdate:modelValue":e[8]||(e[8]=t=>o.detailedAddress=t),placeholder:"街道、楼牌号等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),xe=T(he,[["__scopeId","data-v-625dbe6a"]]);export{xe as default};
